name: Build
on:
  push:
    branches: main
    paths: editable/excerpt.html
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Downloading Java code used by this build
        run: wget --no-verbose https://ebookipedia.github.io/java/build.jar
      - name: Checking out the files in this repository
        uses: actions/checkout@v1
      - name: Configuring user/email to be used for git commits
        run: |
          git config --global user.name "${GH_USERNAME}"
          git config --global user.email "${GH_USERNAME}@users.noreply.github.com"
      - name: Building (publishable) docs/excerpt.html from editable/excerpt.html 
        run: |
          export GITHUB_OAUTH=${{secrets.GITHUB_TOKEN}}
          java -cp https://ebookipedia.github.io/java/build.jar excerpt.Transform
          git add src/source.epub
          git commit -m "epub generated by mediawiki2latex (ubuntu package)"
          git push
      - name: Build (publishable) docs/excerpt.html from editable/excerpt.html 
          if [ ! -f src/$(<out.article).epub ]; then
            sudo apt-get install mediawiki2latex
            mediawiki2latex --epub --url="$(< out.url)" --output="src/source.epub"
            git config --global user.name 'Santiago Ruiz'
            git config --global user.email 'hiebra@hotmail.com'
            git add src/source.epub
            git commit -m "epub generated by mediawiki2latex (ubuntu package)"
            git push
          fi
